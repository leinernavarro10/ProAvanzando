!function(t,i,s){var e={filterHook:function(t,s,e){return!s.length||e.test(i.String(this.getLabel(t)))}},n={__extend:function(){t.extend(this._instance,{filter:new this._queue(this,this._instance.options.queue)}),this._instance.filter.destroy(),this._super()},branch:function(t,i,s){var e=this._instance.queue,n=this.proxy(function(t,i,h){var l=h?this.next(t):this.first(t);l.length&&(this.isInode(l)?this.wasLoad(l)?e.push(function(t){i.call(this,l),n(l,i),n(l,i,!0),t()}):s?this.ajaxLoad(l,{success:function(){i.call(this,l),n(l,i),n(l,i,!0)},fail:function(){n(l,i,!0)}}):e.push(function(t){i.call(this,l),n(l,i,!0),t()}):e.push(function(t){i.call(this,l),n(l,i,!0),t()}))});n(t,i)},swap:function(t){var i=(t=this._options(t,null,"swapfail",null,null)).item1,s=t.item2;if(this.isItem(i)&&this.isItem(s)&&!this.isChildren(i,s)&&!this.isChildren(s,i)&&i.get(0)!=s.get(0)){if(!this._trigger(null,"beforeswap",t))return void this._fail(null,t);var e=this.prev(i);if(e.length)s.get(0)==e.get(0)?s.before(i):(i.insertAfter(s),s.insertAfter(e));else{var n=this.next(i);if(n.length)s.get(0)==n.get(0)?s.after(i):(i.insertAfter(s),s.insertBefore(n));else{h=i.parent();i.insertAfter(s),h.append(s)}}this._updateLevel(i);var h=this.parent(i);this._setFirstLast(h.length?h:null,i),this._updateHidden(i),this._updateLevel(s),h=this.parent(s),this._setFirstLast(h.length?h:null,s),this._updateHidden(s),this._setOddEven(i.add(s)),this._trigger(null,"swapped",t),this._success(null,t)}else this._fail(null,t)},_updateItemLevel:function(t,i,s){t.removeClass("aciTreeLevel"+i).addClass("aciTreeLevel"+s);var e=t.children(".aciTreeLine").find(".aciTreeEntry");if(i<s)for(n=i;n<s;n++)e.wrap('<div class="aciTreeBranch aciTreeLevel'+n+'"></div>');else if(i>s)for(var n=s;n<i;n++)e.unwrap()},_updateChildLevel:function(i,s,e){this.children(i).each(this.proxy(function(i){var n=t(i);this._updateItemLevel(n,s,e),this.isInode(n)&&this.children(n).each(this.proxy(function(i){this._updateChildLevel(t(i),s+1,e+1)},!0))},!0))},_updateLevel:function(t){var s=this.level(t),e=i.parseInt(t.attr("class").match(/aciTreeLevel[0-9]+/)[0].match(/[0-9]+/));s!=e&&(this._updateItemLevel(t,e,s),this._updateChildLevel(t,e+1,s+1))},moveUp:function(t,s){(s=this._options(s)).index=i.Math.max(this.getIndex(t)-1,0),this.setIndex(t,s)},moveDown:function(t,s){(s=this._options(s)).index=i.Math.min(this.getIndex(t)+1,this.siblings(t).length),this.setIndex(t,s)},moveFirst:function(t,i){(i=this._options(i)).index=0,this.setIndex(t,i)},moveLast:function(t,i){(i=this._options(i)).index=this.siblings(t).length,this.setIndex(t,i)},moveBefore:function(t,i){var s=(i=this._options(i,null,"movefail","wasbefore",t)).before;if(this.isItem(t)&&this.isItem(s)&&!this.isChildren(t,s)&&t.get(0)!=s.get(0)){if(!this._trigger(t,"beforemove",i))return void this._fail(t,i);if(this.prev(s,!0).get(0)==t.get(0))this._notify(t,i);else{var e=this.parent(t),n=this.prev(t,!0);n.length||(n=e.length?e:this.first()),t.insertBefore(s),e.length&&!this.hasChildren(e,!0)&&this.setLeaf(e),this._updateLevel(t),this._setFirstLast(e.length?e:null),e=this.parent(t),this._setFirstLast(e.length?e:null,t.add(s)),this._updateHidden(t),this._setOddEven(t.add(s).add(n)),this._trigger(t,"moved",i),this._success(t,i)}}else this._fail(t,i)},moveAfter:function(t,i){var s=(i=this._options(i,null,"movefail","wasafter",t)).after;if(this.isItem(t)&&this.isItem(s)&&!this.isChildren(t,s)&&t.get(0)!=s.get(0)){if(!this._trigger(t,"beforemove",i))return void this._fail(t,i);if(this.next(s,!0).get(0)==t.get(0))this._notify(t,i);else{var e=this.parent(t),n=this.prev(t,!0);n.length||(n=e.length?e:this.first()),t.insertAfter(s),e.length&&!this.hasChildren(e,!0)&&this.setLeaf(e),this._updateLevel(t),this._setFirstLast(e.length?e:null),e=this.parent(t),this._setFirstLast(e.length?e:null,t.add(s)),this._updateHidden(t),this._setOddEven(t.add(s).add(n)),this._trigger(t,"moved",i),this._success(t,i)}}else this._fail(t,i)},asChild:function(t,i){var s=(i=this._options(i,null,"childfail",null,t)).parent;if(this.isItem(t)&&this.isItem(s)&&!this.isChildren(t,s)&&!this.hasChildren(s,!0)&&t.get(0)!=s.get(0)){if(!this._trigger(t,"beforechild",i))return void this._fail(t,i);var e=function(){var e=this.parent(t),n=this.prev(t);n.length||(n=e.length?e:this.first()),this._createContainer(s).append(t),e.length&&!this.hasChildren(e,!0)&&this.setLeaf(e),this._updateLevel(t),this._setFirstLast(e.length?e:null),this._setFirstLast(s.length?s:null,t),this._updateHidden(t),this._setOddEven(t.add(n)),this._trigger(t,"childset",i),this._success(t,i)};this.isInode(s)?e.apply(this):this.setInode(s,this._inner(i,{success:e,fail:i.fail}))}else this._fail(t,i)},_search:function(t,s){for(var e,n,h,l,a=this.children(t),r=!1,c=0,f=a.length;c<f;c++)if(e=a.eq(c),n=i.String(this.getId(e)),(h=n.length)&&n==s.substr(0,h)){l=e,r=s.length==h;break}if(l){if(!r){var o=this._search(l,s);if(o)return o}return{item:l,exact:r}}return null},searchId:function(i,s,e){var n=(e=this._options(e)).id;if(i)if(s){var h=this.proxy(function(t){var i=this._search(t,n);i?i.exact?this._success(i.item,e):this.wasLoad(i.item)?this._fail(t,e):this.ajaxLoad(i.item,this._inner(e,{success:function(){h(i.item)},fail:e.fail})):this._fail(t,e)});h()}else(l=this._search(null,n))&&l.exact?this._success(l.item,e):this._fail(null,e);else{var l=t();this._instance.jQuery.find(".aciTreeLi").each(this.proxy(function(i){if(n==this.getId(t(i)))return l=t(i),!1},!0)),l.length?this._success(l,e):this._fail(null,e)}},search:function(i,s){var e=[];s=this._options(s);var n=new this._task(new this._queue(this,this._instance.options.queue),function(n){e.length?(s.results=t(e),this._success(t(e[0]),s)):this._fail(i,s),n()}),h=this.proxy(function(i){this.children(i,!1,!0).each(this.proxy(function(i){if(s.callback){var h=s.callback.call(this,t(i),s.search);if(h)e.push(i);else if(null===h)return}else this.getId(t(i))==s.search&&e.push(i);this.isInode(t(i))&&n.push(function(s){l(t(i)),s()})},!0))}),l=this.proxy(function(t){this.wasLoad(t)?n.push(function(i){h(t),i()}):s.load&&n.push(function(i){this.ajaxLoad(t,{success:function(){h(t),i()},fail:i})})});n.push(function(t){l(i),t()})},searchPath:function(t,i){var s=(i=this._options(i)).path,e=this.proxy(function(t,n){this.search(t,{success:function(t){s.length?e(t,s.shift()):this._success(t,i)},fail:function(){this._fail(t,i)},search:n,load:i.load,callback:function(t,i){return this.getId(t)==i||null}})});e(t,s.shift())},pathId:function(i,s){var e=[];return this.path(i,s).each(this.proxy(function(i){e.push(this.getId(t(i)))},!0)),e},_regexp:function(t){return new i.RegExp(i.String(t).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"),"i")},filter:function(s,e){if(e=this._options(e,null,"filterfail",null,s),!s||this.isItem(s)){if(!this._trigger(s,"beforefilter",e))return void this._fail(s,e);var n=i.String(e.search),h=this._regexp(n),l=null;this._instance.filter.init();var a=new this._task(this._instance.filter,function(t){this._instance.filter.destroy(),e.first=l,this._setOddEven(),this._trigger(s,"filtered",e),this._success(s,e),t()}),r=this.proxy(function(i){var s=this.children(i,!1,!0),e=!1;s.each(this.proxy(function(i){var s=t(i);this._instance.options.filterHook.call(this,s,n,h)?(l||(l=s),e=!0,s.removeClass("aciTreeHidden")):s.removeClass("aciTreeVisible").addClass("aciTreeHidden"),this.isInode(s)&&a.push(function(t){r(s),t()})},!0)),e&&(i&&this.isHidden(i)&&this._showHidden(i),(!i||this.isOpenPath(i)&&this.isOpen(i))&&s.not(".aciTreeHidden").addClass("aciTreeVisible"),this._setFirstLast(i,this._getFirstLast(i)))});a.push(function(t){r(s),t()})}else this._fail(s,e)},_firstAll:function(t){t.call(this,this.first())},_lastAll:function(t,i,s){if(t){if(this.isInode(t)){if(this.wasLoad(t))return void this._lastAll(this.last(t),i,s);if(s)return void this.ajaxLoad(t,{success:function(){this._lastAll(this.last(t),i,s)},fail:function(){i.call(this,t)}})}i.call(this,t)}else i.call(this,this.last())},_nextAll:function(t,i,s){if(t){if(this.isInode(t)){if(this.wasLoad(t))return void i.call(this,this.first(t));if(s)return void this.ajaxLoad(t,{success:function(){i.call(this,this.first(t))},fail:function(){this._nextAll(t,i,s)}})}var e=this.next(t);if(e.length)i.call(this,e);else{var n=this.proxy(function(t){var i=this.parent(t);if(i.length){var s=this.next(i);return s.length?s:n(i)}return null});i.call(this,n(t))}}else i.call(this,this.first())},_prevAll:function(t,i,s){if(t){var e=this.prev(t);if(e.length)this.isInode(e)?this._lastAll(e,i,s):i.call(this,e);else{var n=this.parent(t);i.call(this,n.length?n:null)}}else i.call(this,this.last())},prevMatch:function(t,i,s){var e=this._regexp(i);this._instance.filter.init();var n=new this._task(this._instance.filter,function(t){this._instance.filter.destroy(),t()}),h=function(t){n.push(function(n){this._prevAll(t,function(t){t?this._instance.options.filterHook.call(this,t,i,e)?s.call(this,t):h(t):s.call(this,null),n()})})};h(this.isItem(t)?t:null)},nextMatch:function(t,i,s){var e=this._regexp(i);this._instance.filter.init();var n=new this._task(this._instance.filter,function(t){this._instance.filter.destroy(),t()}),h=function(t){n.push(function(n){this._nextAll(t,function(t){t?this._instance.options.filterHook.call(this,t,i,e)?s.call(this,t):h(t):s.call(this,null),n()})})};h(this.isItem(t)?t:null)}};aciPluginClass.plugins.aciTree=aciPluginClass.plugins.aciTree.extend(n,"aciTreeUtils"),aciPluginClass.defaults("aciTree",e)}(jQuery,this);