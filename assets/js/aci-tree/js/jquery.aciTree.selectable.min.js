!function(e,t,i){var s={selectable:!0,multiSelectable:!1,fullRow:!1,textSelection:!1},n={__extend:function(){e.extend(this._instance,{focus:!1}),e.extend(this._private,{blurTimeout:null,spinPoint:null}),this._super()},hasFocus:function(){return this._instance.focus},_selectableInit:function(){void 0===this._instance.jQuery.attr("tabindex")&&this._instance.jQuery.attr("tabindex",0),this._instance.options.textSelection||this._selectable(!1),this._instance.jQuery.bind("acitree"+this._private.nameSpace,function(t,i,s,n,c){switch(n){case"closed":var l=i.focused();i.isChildren(s,l)&&i._focusOne(s),i.children(s,!0).each(i.proxy(function(t){var i=e(t);this.isSelected(i)&&this.deselect(i)},!0))}}).bind("focusin"+this._private.nameSpace,this.proxy(function(){t.clearTimeout(this._private.blurTimeout),this.hasFocus()||(this._instance.focus=!0,this._instance.jQuery.addClass("aciTreeFocus"),this._trigger(null,"focused"))})).bind("focusout"+this._private.nameSpace,this.proxy(function(){t.clearTimeout(this._private.blurTimeout),this._private.blurTimeout=t.setTimeout(this.proxy(function(){this.hasFocus()&&(this._instance.focus=!1,this._instance.jQuery.removeClass("aciTreeFocus"),this._trigger(null,"blurred"))}),10)})).bind("keydown"+this._private.nameSpace,this.proxy(function(t){if(this.hasFocus()){var i=this.focused();if(i.length&&this.isBusy(i))return!1;var s=e([]);switch(t.which){case 65:if(this._instance.options.multiSelectable&&t.ctrlKey){var n=this.visible(this.enabled(this.children(null,!0))).not(this.selected());n.each(this.proxy(function(t){this.select(e(t),{focus:!1})},!0)),this.focused().length||this._focusOne(this.visible(n,!0).first()),t.preventDefault()}break;case 38:s=i.length?this._prev(i):this.first();break;case 40:s=i.length?this._next(i):this.first();break;case 37:i.length?this.isOpen(i)?(s=i,this.close(i,{collapse:this._instance.options.collapse,expand:this._instance.options.expand,unique:this._instance.options.unique})):s=this.parent(i):s=this._first();break;case 39:i.length?this.isInode(i)&&this.isClosed(i)?(s=i,this.open(i,{collapse:this._instance.options.collapse,expand:this._instance.options.expand,unique:this._instance.options.unique})):s=this.first(i):s=this._first();break;case 33:s=i.length?this._prevPage(i):this._first();break;case 34:s=i.length?this._nextPage(i):this._first();break;case 36:s=this._first();break;case 35:s=this._last();break;case 13:case 107:s=i,this.isInode(i)&&this.isClosed(i)&&this.open(i,{collapse:this._instance.options.collapse,expand:this._instance.options.expand,unique:this._instance.options.unique});break;case 27:case 109:s=i,this.isOpen(i)&&this.close(i,{collapse:this._instance.options.collapse,expand:this._instance.options.expand,unique:this._instance.options.unique}),27==t.which&&t.preventDefault();break;case 32:s=i,this.isInode(i)&&!t.ctrlKey&&this.toggle(i,{collapse:this._instance.options.collapse,expand:this._instance.options.expand,unique:this._instance.options.unique}),t.preventDefault();break;case 106:s=i,this.isInode(i)&&this.open(i,{collapse:this._instance.options.collapse,expand:!0,unique:this._instance.options.unique})}return s.length?(!this._instance.options.multiSelectable||t.ctrlKey||t.shiftKey||this._unselect(this.selected().not(s)),this.isVisible(s)||this.setVisible(s),t.ctrlKey?32==t.which&&this.isEnabled(s)?(this.isSelected(s)?this.deselect(s):this.select(s),this._private.spinPoint=s):this._focusOne(s):t.shiftKey?this._shiftSelect(s):(!this.isSelected(s)&&this.isEnabled(s)?this.select(s):this._focusOne(s),this._private.spinPoint=s),!1):void 0}})),this._fullRow(this._instance.options.fullRow),this._multiSelectable(this._instance.options.multiSelectable)},_fullRow:function(e){this._instance.jQuery.off(this._private.nameSpace,".aciTreeLine,.aciTreeItem").off(this._private.nameSpace,".aciTreeItem"),this._instance.jQuery.on("mousedown"+this._private.nameSpace+" click"+this._private.nameSpace,e?".aciTreeLine,.aciTreeItem":".aciTreeItem",this.proxy(function(e){var t=this.itemFrom(e.target);this.isVisible(t)||this.setVisible(t),e.ctrlKey?"click"==e.type&&(this.isEnabled(t)?this.isSelected(t)?(this.deselect(t),this._focusOne(t)):this.select(t):this._focusOne(t)):this._instance.options.multiSelectable&&e.shiftKey?this._shiftSelect(t):(!this._instance.options.multiSelectable||this.isSelected(t)&&"click"!=e.type||this._unselect(this.selected().not(t)),this._selectOne(t)),e.shiftKey||(this._private.spinPoint=t)})).on("dblclick"+this._private.nameSpace,e?".aciTreeLine,.aciTreeItem":".aciTreeItem",this.proxy(function(e){var t=this.itemFrom(e.target);if(this.isInode(t))return this.toggle(t,{collapse:this._instance.options.collapse,expand:this._instance.options.expand,unique:this._instance.options.unique}),!1}))},_multiSelectable:function(e){if(e)this._instance.jQuery.attr("aria-multiselectable",!0);else{var t=this.focused();this._unselect(this.selected().not(t)),this._instance.jQuery.removeAttr("aria-multiselectable")}},_shiftSelect:function(t){if(!(i=this._private.spinPoint)||!e.contains(this._instance.jQuery.get(0),i.get(0))||!this.isOpenPath(i))var i=this.focused();if(i.length){var s=[t.get(0)],n=i.get(0),c=!1,l=t.get(0);this.visible(this.children(null,!0)).each(this.proxy(function(t){if(c){if(this.isEnabled(e(t))&&s.push(t),t==n||t==l)return!1}else if(t==n||t==l){if(this.isEnabled(e(t))&&s.push(t),t==n&&t==l)return!1;c=!0}},!0)),this._unselect(this.selected().not(s)),e(s).not(t).each(this.proxy(function(t){var i=e(t);this.isSelected(i)||this.select(i,{focus:!1})},!0))}this._selectOne(t)},_initHook:function(){this.extSelectable()&&this._selectableInit(),this._super()},_itemHook:function(e,t,i,s){this.extSelectable()&&this._selectableDOM.select(t,i.selected),this._super(e,t,i,s)},_selectableDOM:{select:function(e,t){t?e.addClass("aciTreeSelected").attr("aria-selected",!0):e.removeClass("aciTreeSelected").attr("aria-selected",!1)},focus:function(e,t){t?e.addClass("aciTreeFocus").focus():e.removeClass("aciTreeFocus")}},_selectable:function(t){t?this._instance.jQuery.css({"-webkit-user-select":"text","-moz-user-select":"text","-ms-user-select":"text","-o-user-select":"text","user-select":"text"}).attr({unselectable:null,onselectstart:null}).unbind("selectstart"+this._private.nameSpace):this._instance.jQuery.css({"-webkit-user-select":"none","-moz-user-select":"-moz-none","-ms-user-select":"none","-o-user-select":"none","user-select":"none"}).attr({unselectable:"on",onselectstart:"return false"}).bind("selectstart"+this._private.nameSpace,function(t){if(!e(t.target).is("input,textarea"))return!1})},_first:function(){return e(c.first(this._instance.jQuery[0],function(e){return!!this.hasClass(e,"aciTreeVisible")||null}))},_last:function(){return e(c.last(this._instance.jQuery[0],function(e){return!!this.hasClass(e,"aciTreeVisible")||null}))},_prev:function(t){return e(c.prevAll(t[0],function(e){return!!this.hasClass(e,"aciTreeVisible")||null}))},_next:function(t){return e(c.nextAll(t[0],function(e){return!!this.hasClass(e,"aciTreeVisible")||null}))},_height:function(e){return e.children(".aciTreeLine").find(".aciTreeItem").outerHeight(!0)},_prevPage:function(e){for(var t=this._instance.jQuery.find(".aciTreeVisible"),i=this._instance.jQuery.height(),s=this._height(e),n=e,c=t.index(e);s<i&&c>0;)c--,n=t.eq(c),s+=this._height(n);return n},_nextPage:function(e){for(var t=this._instance.jQuery.find(".aciTreeVisible"),i=this._instance.jQuery.height(),s=this._height(e),n=e,c=t.index(e);s<i&&c<t.length-1;)c++,n=t.eq(c),s+=this._height(n);return n},_selectOne:function(e){this.isSelected(e)?this._focusOne(e):this.isEnabled(e)?this.select(e):this._focusOne(e)},_unselect:function(t){t.each(this.proxy(function(t){this.deselect(e(t))},!0))},_focusOne:function(e){this._instance.options.multiSelectable||this._unselect(this.selected().not(e)),this.isFocused(e)||this.focus(e)},select:function(t,i){if(i=this._options(i,"selected","selectfail","wasselected",t),this.extSelectable()&&this.isItem(t)){if(!this._trigger(t,"beforeselect",i))return void this._fail(t,i);if(i.oldSelected=this.selected(),!this._instance.options.multiSelectable){var s=i.oldSelected.not(t);this._selectableDOM.select(s,!1),s.each(this.proxy(function(t){this._trigger(e(t),"deselected",i)},!0))}this.isSelected(t)?this._notify(t,i):(this._selectableDOM.select(t,!0),this._success(t,i)),(void 0===i.focus||i.focus)&&(this.isFocused(t)&&!i.focus||this.focus(t,this._inner(i)))}else this._fail(t,i)},deselect:function(e,t){if(t=this._options(t,"deselected","deselectfail","notselected",e),this.extSelectable()&&this.isItem(e)){if(!this._trigger(e,"beforedeselect",t))return void this._fail(e,t);this.isSelected(e)?(this._selectableDOM.select(e,!1),this._success(e,t)):this._notify(e,t)}else this._fail(e,t)},focus:function(t,i){if(i=this._options(i,"focus","focusfail","wasfocused",t),this.extSelectable()&&this.isItem(t)){if(!this._trigger(t,"beforefocus",i))return void this._fail(t,i);i.oldFocused=this.focused();var s=i.oldFocused.not(t);this._selectableDOM.focus(s,!1),s.each(this.proxy(function(t){this._trigger(e(t),"blur",i)},!0)),this.isFocused(t)?this._notify(t,i):(this._selectableDOM.focus(t,!0),this._success(t,i))}else this._fail(t,i)},blur:function(e,t){if(t=this._options(t,"blur","blurfail","notfocused",e),this.extSelectable()&&this.isItem(e)){if(!this._trigger(e,"beforeblur",t))return void this._fail(e,t);this.isFocused(e)?(this._selectableDOM.focus(e,!1),this._success(e,t)):this._notify(e,t)}else this._fail(e,t)},selected:function(){return this._instance.jQuery.find(".aciTreeSelected")},_serialize:function(e,t){var i=this._super(e,t);return i&&this.extSelectable()&&(i.hasOwnProperty("selected")?i.selected=this.isSelected(e):this.isSelected(e)&&(i.selected=!0)),i},isSelected:function(e){return e&&e.hasClass("aciTreeSelected")},focused:function(){return this._instance.jQuery.find(".aciTreeFocus")},isFocused:function(e){return e&&e.hasClass("aciTreeFocus")},extSelectable:function(){return this._instance.options.selectable},option:function(e,t){this.wasInit()&&!this.isLocked()&&("selectable"==e&&t!=this.extSelectable()&&(t?this._selectableInit():this._selectableDone()),"multiSelectable"==e&&t!=this._instance.options.multiSelectable&&this._multiSelectable(t),"fullRow"==e&&t!=this._instance.options.fullRow&&this._fullRow(t),"textSelection"==e&&t!=this._instance.options.textSelection&&this._selectable(t)),this._super(e,t)},_selectableDone:function(e){if(0==this._instance.jQuery.attr("tabindex")&&this._instance.jQuery.removeAttr("tabindex"),this._instance.options.textSelection||this._selectable(!0),this._instance.jQuery.unbind(this._private.nameSpace),this._instance.jQuery.off(this._private.nameSpace,".aciTreeLine,.aciTreeItem").off(this._private.nameSpace,".aciTreeItem"),this._instance.jQuery.removeClass("aciTreeFocus").removeAttr("aria-multiselectable"),this._instance.focus=!1,this._private.spinPoint=null,!e){this._unselect(this.selected());var t=this.focused();t.length&&this.blur(t)}},_destroyHook:function(e){e&&this._selectableDone(!0),this._super(e)}};aciPluginClass.plugins.aciTree=aciPluginClass.plugins.aciTree.extend(n,"aciTreeSelectable"),aciPluginClass.defaults("aciTree",s);var c=aciPluginClass.plugins.aciTree_dom}(jQuery,this);