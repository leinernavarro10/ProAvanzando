!function(e,t,i){var s={sortable:!1,sortDelay:750,sortDrag:function(e,t,i,s){i||s.html(this.getLabel(e))},sortValid:function(e,t,i,s,r,a){s?(a.html("move "+this.getLabel(e)+" to "+this.getLabel(this.itemFrom(t))),r.removeClass("aciTreeAfter aciTreeBefore")):null!==i&&(i?(a.html("move "+this.getLabel(e)+" before "+this.getLabel(t)),r.removeClass("aciTreeAfter").addClass("aciTreeBefore")):(a.html("move "+this.getLabel(e)+" after "+this.getLabel(t)),r.removeClass("aciTreeBefore").addClass("aciTreeAfter")))}},r={__extend:function(){e.extend(this._private,{openTimeout:null,dragDrop:null}),this._super()},_sortableInit:function(){this._instance.jQuery.aciSortable({container:".aciTreeUl",item:".aciTreeLi",child:50,childHolder:'<ul class="aciTreeUl aciTreeChild"></ul>',childHolderSelector:".aciTreeChild",placeholder:'<li class="aciTreeLi aciTreePlaceholder"><div></div></li>',placeholderSelector:".aciTreePlaceholder",helper:'<div class="aciTreeHelper"></div>',helperSelector:".aciTreeHelper",before:this.proxy(function(e){return!!this._initDrag(e)&&(!!this._trigger(e,"beforedrag")||(this._trigger(e,"dragfail"),!1))}),start:this.proxy(function(e,t,i){this._instance.jQuery.addClass("aciTreeDragDrop"),i.css({opacity:1}).html(this.getLabel(e))}),drag:this.proxy(function(e,i,s,r){s||t.clearTimeout(this._private.openTimeout),this._instance.options.sortDrag&&this._instance.options.sortDrag.apply(this,arguments)}),valid:this.proxy(function(e,i,s,r,a,n){if(t.clearTimeout(this._private.openTimeout),!this._checkDrop(e,i,s,r,a,n))return!1;var o=this._options({hover:i,before:s,isContainer:r,placeholder:a,helper:n});return!!this._trigger(e,"checkdrop",o)&&(!r&&this.isInode(i)&&(this.isOpen(i)||i.data("opening"+this._private.nameSpace)||(this._private.openTimeout=t.setTimeout(this.proxy(function(){i.data("opening"+this._private.nameSpace,!0),this.open(i,{success:function(e){e.removeData("opening"+this._private.nameSpace)},fail:function(e){e.removeData("opening"+this._private.nameSpace)}})}),this._instance.options.sortDelay))),this._instance.options.sortValid&&this._instance.options.sortValid.apply(this,arguments),!0)}),create:this.proxy(function(e,t,i){return!!this.isLeaf(i)&&(i.append(e._instance.options.childHolder),!0)},!0),end:this.proxy(function(i,s,r,a){t.clearTimeout(this._private.openTimeout);var n={placeholder:r,helper:a};if(n=this._options(n,"sorted","dropfail",null,i),r.parent().length){var o=this.prev(r,!0);if(o.length){r.detach();p=e(this._private.dragDrop.get().reverse());this._private.dragDrop=null,p.each(this.proxy(function(t){this.moveAfter(e(t),this._inner(n,{success:n.success,fail:n.fail,after:o}))},!0))}else{var l=this.next(r,!0);if(l.length){r.detach();p=e(this._private.dragDrop.get().reverse());this._private.dragDrop=null,p.each(this.proxy(function(t){this.moveBefore(e(t),this._inner(n,{success:n.success,fail:n.fail,before:l}))},!0))}else{var h=this.parent(r),c=r.parent();if(r.detach(),c.remove(),this.isLeaf(h)){var p=this._private.dragDrop;this.asChild(p.eq(0),this._inner(n,{success:function(){this._success(i,n),this.open(h),p.filter(":gt(0)").each(this.proxy(function(t){this.moveAfter(e(t),this._inner(n,{success:n.success,fail:n.fail,after:this.last(h)}))},!0))},fail:n.fail,parent:h}))}else this._fail(i,n)}}}else this._fail(i,n);if(this._private.dragDrop=null,a.parent().length){var u=e(t).scrollTop(),f=e(t).scrollLeft(),d=i.get(0).getBoundingClientRect();a.animate({top:d.top+u,left:d.left+f,opacity:0},{complete:function(){a.detach()}})}this._instance.jQuery.removeClass("aciTreeDragDrop")})})},_initHook:function(){this.extSortable()&&this._sortableInit(),this._super()},_parents:function(e){for(var t,i,s=e.length,r=[],a=0;a<s-1;a++){t=e.eq(a);for(var n=a+1;n<s;n++)i=e.eq(n),this.isChildren(t,i)?r.push(e[n]):this.isChildren(i,t)&&r.push(e[a])}return e.not(r)},_initDrag:function(e){if(this.extSelectable&&this.extSelectable()){if(this.hasFocus()||this._instance.jQuery.focus(),!this.isEnabled(e))return!1;var t=this.selected();if(t.length){if(!this.isSelected(e))return!1}else t=e;this._private.dragDrop=this._parents(t)}else this._instance.jQuery.focus(),this._private.dragDrop=e;return!0},_checkDrop:function(e,t,i,s,r,a){var n=this._private.dragDrop;if(!n)return!1;var o=this.itemFrom(t);return!n.is(o)&&!n.has(o.get(0)).length&&!(!s&&(o=i?this.prev(t):this.next(t),n.is(o)))},extSortable:function(){return this._instance.options.sortable},option:function(e,t){this.wasInit()&&!this.isLocked()&&"sortable"==e&&t!=this.extSortable()&&(t?this._sortableInit():this._sortableDone()),this._super(e,t)},_sortableDone:function(){this._instance.jQuery.unbind(this._private.nameSpace),this._instance.jQuery.aciSortable("destroy")},_destroyHook:function(e){e&&this._sortableDone(),this._super(e)}};aciPluginClass.plugins.aciTree=aciPluginClass.plugins.aciTree.extend(r,"aciTreeSortable"),aciPluginClass.defaults("aciTree",s)}(jQuery,this);