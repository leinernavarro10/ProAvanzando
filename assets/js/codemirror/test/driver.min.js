function Failure(e){this.message=e}function indexOf(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;n<r;++n)if(e[n]==t)return n;return-1}function test(e,t,n){for(var r=e,i=2;-1!==indexOf(allNames,e);)e=r+"_"+i,i++;return allNames.push(e),tests.push({name:e,func:t,expectedFail:n}),e}function testCM(e,t,n,r){return test(namespace+e,function(){var e=document.getElementById("testground"),r=window.cm=CodeMirror(e,n),i=!1;try{t(r),i=!0}finally{!i||verbose?e.style.visibility="visible":e.removeChild(r.getWrapperElement())}},r)}function runTests(e){function t(r){if(r===tests.length)return running=!1,e("done");var i=tests[r],l=i.expectedFail,a=+new Date;if(filters.length){for(var s=0;s<filters.length&&!i.name.match(filters[s]);s++);if(s==filters.length)return e("skipped",i.name,f),t(r+1)}var u=!1;try{var f=i.func()}catch(t){if(u=!0,l)e("expected",i.name);else if(t instanceof Failure)e("fail",i.name,t.message);else{var o=/(?:\bat |@).*?([^\/:]+):(\d+)/.exec(t.stack);e("error",i.name,t.toString()+(o?" ("+o[1]+":"+o[2]+")":""))}}if(u||(l?e("fail",i.name,f||"expected failure, but succeeded"):e("ok",i.name,f)),quit)return running=!1,null;var c=0;(n+=+new Date-a)>500&&(n=0,c=50),setTimeout(function(){t(r+1)},c)}var n=0;t(0)}function label(e,t){return t?e+" ("+t+")":e}function eq(e,t,n){if(e!=t)throw new Failure(label(e+" != "+t,n))}function eqPos(e,t,n){function r(e){return"{line:"+e.line+",ch:"+e.ch+"}"}if(e!=t){if(null==e)throw new Failure(label("comparing null to "+r(t),n));if(null==t)throw new Failure(label("comparing "+r(e)+" to null",n));if(e.line!=t.line||e.ch!=t.ch)throw new Failure(label(r(e)+" != "+r(t),n))}}function is(e,t){if(!e)throw new Failure(label("assertion failed",t))}function countTests(){if(!filters.length)return tests.length;for(var e=0,t=0;t<tests.length;++t)for(var n=tests[t].name,r=0;r<filters.length;r++)if(n.match(filters[r])){++e;break}return e}function parseTestFilter(e){return/_\*$/.test(e)?new RegExp("^"+e.slice(0,e.length-2),"i"):new RegExp(e,"i")}var tests=[],filters=[],allNames=[];Failure.prototype.toString=function(){return this.message};var namespace="";