CodeMirror.defineMode("smartymixed",function(e){var t,l,i,r=CodeMirror.getMode(e,"htmlmixed"),a=CodeMirror.getMode(e,"smarty"),n={rightDelimiter:"}",leftDelimiter:"{"};return e.hasOwnProperty("leftDelimiter")&&(n.leftDelimiter=e.leftDelimiter),e.hasOwnProperty("rightDelimiter")&&(n.rightDelimiter=e.rightDelimiter),t={smartyComment:new RegExp("^"+n.leftDelimiter+"\\*"),literalOpen:new RegExp(n.leftDelimiter+"literal"+n.rightDelimiter),literalClose:new RegExp(n.leftDelimiter+"/literal"+n.rightDelimiter),hasLeftDelimeter:new RegExp(".*"+n.leftDelimiter),htmlHasLeftDelimeter:new RegExp("[^<>]*"+n.leftDelimiter)},l={chain:function(e,t,l){return t.tokenize=l,l(e,t)},cleanChain:function(e,t,l){return t.tokenize=null,t.localState=null,t.localMode=null,"string"==typeof l?l||null:l(e,t)},maybeBackup:function(e,t,l){var i=e.current(),r=i.search(t);return r>-1?e.backUp(i.length-r):i.match(/<\/?$/)&&(e.backUp(i.length),e.match(t,!1)||e.match(i[0])),l}},i={html:function(e,o){return!o.inLiteral&&e.match(t.htmlHasLeftDelimeter,!1)&&null===o.htmlMixedState.htmlState.tagName?(o.tokenize=i.smarty,o.localMode=a,o.localState=a.startState(r.indent(o.htmlMixedState,"")),l.maybeBackup(e,n.leftDelimiter,a.token(e,o.localState))):!o.inLiteral&&e.match(n.leftDelimiter,!1)?(o.tokenize=i.smarty,o.localMode=a,o.localState=a.startState(r.indent(o.htmlMixedState,"")),l.maybeBackup(e,n.leftDelimiter,a.token(e,o.localState))):r.token(e,o.htmlMixedState)},smarty:function(e,o){if(e.match(n.leftDelimiter,!1)){if(e.match(t.smartyComment,!1))return l.chain(e,o,i.inBlock("comment","*"+n.rightDelimiter))}else if(e.match(n.rightDelimiter,!1))return e.eat(n.rightDelimiter),o.tokenize=i.html,o.localMode=r,o.localState=o.htmlMixedState,"tag";return l.maybeBackup(e,n.rightDelimiter,a.token(e,o.localState))},inBlock:function(e,t){return function(i,r){for(;!i.eol();){if(i.match(t)){l.cleanChain(i,r,"");break}i.next()}return e}}},{startState:function(){var e=r.startState();return{token:i.html,localMode:null,localState:null,htmlMixedState:e,tokenize:null,inLiteral:!1}},copyState:function(e){var t=null,l=e.tokenize||e.token;return e.localState&&(t=CodeMirror.copyState(l!=i.html?a:r,e.localState)),{token:e.token,tokenize:e.tokenize,localMode:e.localMode,localState:t,htmlMixedState:CodeMirror.copyState(r,e.htmlMixedState),inLiteral:e.inLiteral}},token:function(e,l){if(e.match(n.leftDelimiter,!1)){if(!l.inLiteral&&e.match(t.literalOpen,!0))return l.inLiteral=!0,"keyword";if(l.inLiteral&&e.match(t.literalClose,!0))return l.inLiteral=!1,"keyword"}return l.inLiteral&&l.localState!=l.htmlMixedState&&(l.tokenize=i.html,l.localMode=r,l.localState=l.htmlMixedState),(l.tokenize||l.token)(e,l)},indent:function(e,l){return e.localMode==a||e.inLiteral&&!e.localMode||t.hasLeftDelimeter.test(l)?CodeMirror.Pass:r.indent(e.htmlMixedState,l)},innerMode:function(e){return{state:e.localState||e.htmlMixedState,mode:e.localMode||r}}}},"htmlmixed"),CodeMirror.defineMIME("text/x-smarty","smartymixed");